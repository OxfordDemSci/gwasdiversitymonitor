{% extends "base.html" %}

{% block content %}

    <div class="dashboard row">

        <div class="loader">Loader</div>

        <div class="tile col-xs-12 col-sm-6 col-lg-3">
            <div class="box summary">
                {% include 'tiles/summary.html' %}
            </div>
        </div>

        <div class="tile col-xs-12 col-lg-6">
            <div class="box only-stage" id="bubbleGraph">
                {% include 'tiles/bubble-graph.html' %}
            </div>
        </div>

        <div class="tile col-xs-12 col-sm-6 col-lg-3">
            <div class="box metric-stage" id="timeSeries">
                {% include 'tiles/time-series.html' %}
            </div>
        </div>

        <div class="tile col-xs-12 col-sm-6 col-lg-3">
            <div class="box metric-stage heat-map" id="heatMap">
                {% include 'tiles/heat-map.html' %}
            </div>
        </div>

        <div class="tile col-xs-12 col-lg-6">
            <div class="box only-metric world-map" id="worldMap">
                {% include 'tiles/world-map.html' %}
            </div>
        </div>

        <div class="tile col-xs-12 col-sm-6 col-lg-3">
            <div class="box metric-stage doughnut-graph" id="doughnutGraph">
                {% include 'tiles/doughnut-graph.html' %}
            </div>
        </div>

    </div>

    <div id="watermark" style="display: none;">
        <svg width="46px" height="77px" viewBox="0 0 46 77" version="1.1" xmlns="http://www.w3.org/2000/svg">
            <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <g id="Logo">
                    <rect id="Rectangle" fill="#489ED8" fill-rule="nonzero" x="6" y="0" width="17" height="4"></rect>
                    <rect id="Rectangle-Copy-12" fill="#54BDBE" fill-rule="nonzero" x="23" y="8" width="17" height="4"></rect>
                    <rect id="Rectangle-Copy-13" fill="#ED7892" fill-rule="nonzero" x="6" y="29" width="17" height="4"></rect>
                    <rect id="Rectangle-Copy-14" fill="#FECE59" fill-rule="nonzero" x="6" y="40" width="17" height="4"></rect>
                    <rect id="Rectangle-Copy-15" fill="#F59C44" fill-rule="nonzero" x="23" y="68" width="17" height="4"></rect>
                    <path d="M35.2729535,57.7520701 C41.7099333,61.7887945 45.9960316,68.9058501 46,76.9958598 L38.8986238,77 C38.8946554,68.3305651 31.7721839,61.275613 23.0249592,61.275613 L22.9750408,61.275613 C14.2276073,61.275613 7.10743329,68.3305651 7.10137623,77 L0,76.9958598 C0.00417728014,68.9058501 4.29215534,61.7887945 10.7291352,57.7520701 C4.29215534,53.7153457 0.00417728014,46.5982901 0,38.5082805 L0,38.4917195 C0.00417728014,30.4017099 4.29215534,23.2846543 10.7291352,19.2479299 C4.29215534,15.2112055 0.00417728014,8.09414991 0,0.00414023013 L7.10137623,0 C7.10743329,8.6696419 14.2276073,15.724594 22.9750408,15.724594 L23.0249592,15.724594 C31.7721839,15.724594 38.8946554,8.6696419 38.8986238,0 L46,0.00414023013 C45.9960316,6.278659 43.4186497,11.9694053 39.2580787,16.0889343 C35.0975077,20.2105334 29.3558362,22.7629853 23.0249592,22.7629853 L23.0249592,22.7712657 L22.9750408,22.7712657 C14.2276073,22.7712657 7.10743329,29.8262179 7.10137623,38.4958598 L7.10137623,38.5041402 C7.10743329,47.1737821 14.2276073,54.2287343 22.9750408,54.2287343 L23.0249592,54.2287343 C30.5440635,54.2287343 36.8621997,49.0161845 38.4915478,42.044037 C38.7568051,40.9054737 38.8986238,39.7213679 38.8986238,38.5041402 L45.9709679,38.5082805 L46,38.5082805 C46,38.8871115 45.9897657,39.2638725 45.9709679,39.6385633 C45.9312837,40.4521185 45.8477381,41.2553232 45.7203311,42.044037 C44.6739224,48.6456339 40.7533361,54.3156791 35.2729535,57.7520701" id="Fill-1" fill="#212C8F"></path>
                </g>
            </g>
        </svg>
    </div>

    <div id="downloadShell" style="display: none;"></div>

    <script src="{{ url_for('static', filename='js/graphs/time-series.js') }}"></script>
    <script src="{{ url_for('static', filename='js/graphs/world-map.js') }}"></script>
    <script src="{{ url_for('static', filename='js/graphs/bubble-graph.js') }}"></script>
    <script src="{{ url_for('static', filename='js/graphs/heat-map.js') }}"></script>
    <script src="{{ url_for('static', filename='js/graphs/doughnut-graph.js') }}"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            drawTimeSeries({{ tsPlot|tojson }}, '#timeSeries');
            drawWorldMapChart({{ chloroMap|tojson }});
            drawBubbleGraph("#bubbleGraph", {{ bubbleGraph|tojson }});
            drawHeatMap({{ heatMap|tojson }}, false, false);
            drawDoughnutGraph("#doughnutGraph", {{ doughnutGraph|tojson }}, false, false);
            downloadImage();
            setDescription();
        });

        function highlight(box) {
            box.addClass('highlight');
            setTimeout(function() {
                box.removeClass('highlight');
            }, 1500)
        }

        function redrawGraph(el) {
            let switchMetric = document.getElementById('cb1');
            let switchStage = document.getElementById('cb2');

            // Redraw with Studies
            drawWorldMapChart({{ chloroMap|tojson }}, switchMetric.checked);
            drawTimeSeries({{ tsPlot|tojson }}, '#timeSeries', switchMetric.checked, switchStage.checked);
            drawHeatMap({{ heatMap|tojson }}, switchMetric.checked, switchStage.checked);
            drawDoughnutGraph("#doughnutGraph", {{ doughnutGraph|tojson }}, switchMetric.checked, switchStage.checked);

            // Change titles
            filtersTitle(switchMetric.checked, switchStage.checked);
            setDescription();

            // Highlight boxes
            var both = $('.metric-stage');
            if($(el).attr('id') === 'cb1') {
                var box = $('.only-metric');
            } else {
                var box = $('.only-stage');
                drawBubbleGraph("#bubbleGraph", {{ bubbleGraph|tojson }}, switchStage.checked);
            }
            highlight(both);
            highlight(box);
        }

        function filtersTitle(metric, stage) {
            let metricTitle = $('.metric-title');
            let stageTitle = $('.stage-title');

            if(metric) {
                metricTitle.html('Studies');
                if(stage) {
                    stageTitle.html('Replication');
                } else {
                    stageTitle.html('Discovery');
                }
            } else {
                metricTitle.html('Participants');
                if(stage) {
                    stageTitle.html('Replication');
                } else {
                    stageTitle.html('Discovery');
                }
            }
        }

        function numberFormatter(val) {
            if(val >= 1000000) {
                val = val / 1000000;
                val = Math.round( val * 10 ) / 10;
                val = val+"M";
            } else if(val >= 1000) {
                val = val / 1000;
                val = Math.round( val * 10 ) / 10;
                val = val+"k";
            } else {
                val = Math.round(val);
            }

            return val;
        }
    </script>
{% endblock %}